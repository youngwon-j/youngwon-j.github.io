---
layout: post
title: DB 및 네트워크 부하
---
* 데이터 베이스 Call 결과 전송은 네트워크를 통해 이루어짐
* RoundTrip 횟수가 많을수록 쿼리 수행속도가 떨어짐

### 데이터베이스 CALL 종류
## SQL 커서에 대한 작업 요청에 따른 구문
* Parse Call : SQL 파싱을 요청하는 Call
* Execute Call : SQL 실행을 요청하는 Call
* Fetch Call : Select 문의 결과 데이터 전송을 요청하는 Call

### Call 발생 위치에 따른 구분
## User Call
* DBMS 외부러 부터 요청되는 Call
* 동접수가 많은 Peek 시간대에 확장성을 떨어뜨리는 가장 큰 요인
* UserCall이 많이 발생하도록 개발된 프로그램은 성능이 좋을 수 없으므로 UserCall 을 최소화 하려 노력해야함
** Loop 쿼리 해소 및 집합적 사고를 통해 One SQL 구현
** Array Processin g: Array 단위 Fetch, bulk Insert/Update/Delete
** 부분 범위처리 원리 활용
** 효과적인 화면 페이징 처리
** 사용자정의 함수/프로시저/트리거 활용

## Recursive Call
* DBMS 내부에서 발생하는 Call
* SQL 파싱 및 최적화 과정에서 발생하는 딕셔너리 조회, 사용자 정의 함수/프로시져 내에서의 SQL 수행이 해당됨
* RecursiveCall 최소화를 위해 바인드 변수 사용 > 하드파싱 횟수 감소시켜야함

### 데이터베이스 Call 과 성능
## One Query 구현의 중요성
* 루프를 돌면서 여러 작업을 반복 수행하는 프로그램을 one SQL 로 구현했을 때, 놀라운 성능개선이 일어남

### 데이터베이스 Call과 시스템 확장성
* 데이터베이스의 call 은 개별 프로그램의 수행 속도에 큰 영향을 미치므로 최소화 해야한다

### Array Processing 활용
* Insert 할 데이터를 Array 에 담기만 하다가 일정 건 이상 쌓일때마다 SQL 수행
* 대용량 데이터 처리에 있어 Array Processing은 필수적이며, 효과 극대화를 위해서는 연속된 일련의 처리과정이 모두 Array 단위로 진행되어야 함.
* Array Processing 을 활용하면 한번의 SQL 수행으로 다량의 레코드 동시처리 가능
* 네트워크를 통한 Call을 줄이고, 궁극적으로는 SQL 수행시간 및 CPU 사용량을 획기적으로 줄여줌

### FetchCall 최소화
## 부분 범위처리 원리
* 쿼리 결과집합을 전송할 때, 전체 데이터를 연속적으로 전송하지 않고 사용자로부터 Fetch Call 이 있을 때마다 일정량씩 나누어 전송하는 것
** DBMS 는 데이터를 클라이언트에게 전송할 떄 일정량씩 나누어 전송
** Oracle 의 경우 ArraySize(FetchSize) 설정을 통해 운반단위 조절 가능

## ArraySize 조정에 의한 Fetch Call 감소 및 블록 I/O 감소 효과
* 네트워크를 통해 전송해야 할 데이터 양에 따라 ArraySize를 조절해야함
* 적당한 범위 내에서 ArraySize를 증가시키면 네트워크 부하가 줄어들며 서버 프로세스가 읽어야 할 블록 개수까지 줄어듦으로 효과적임

### 페이지 처리 활용
* 페이지 처리를 하지 않았을 때의 부하요인
** 다량 발생하는 Fetch Call 부하
** 대량의 결과 집합을 클라이언트로 전송하면서 발생하는 네트워크 부하
** 대량의 데이터 블록을 읽으면서 발생하는 I/O 부하
** AP 서버 및 웹 서버 리소스 사용량 증가
* 부하를 해소하기 위한 페이지 처리
** 페이지 단위로 화면에서 필요한 만큼만 FetchCall
** 페이지 단위로 화면에서 필요한 만큼만 네트워크를 통해 결과 전송
** 인덱스와 부분범위 처리 원리를 이용해 각 페이지에 필요한 최소량만 I/O
** 데이터를 소량씩 나누어 전송하므로 AP 웹서버 리소스 사용량 최소화

### 분산쿼리
* 분산쿼리의 성능을 높이는 원리는,, 네트워크를 통한 데이터 전송량을 줄이는데 있다.

### 사용자 정의 함수 / 프로시저의 특징과 성능
*  반복적으로 사용되는 소스를 함수로써 모듈화 하는것을 권장
## 사용자 정의 함수 / 프로시저의 특징
* 사용자 정의 함수 / 프로시저는 가상머신같은 별도의 실행엔진을 통해 실행됨
* 실행될 때 마다 컨텍스트 스위칭이 일어나며 이 때문에 내장함수를 호출할 때와 비교해 성능이 낮음
## 사용자 정의 함수 / 프로시져 성능 저하 해소 방안
* 사용자 정의 함수는 소량의 데이터를 조회할 때 혹은 부분 범위 처리가 가능한 상황에서 제한적으로 사용
* 가급적 One SQL 로 풀어내는 것을 권장






